<!-- pages/mypage.html -->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <title>마이페이지 | FindMate</title>
    <style>
      .wrap-anywhere {
        overflow-wrap: anywhere;
        word-break: break-word;
      }
      .clamp-1{
         display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;  /* 핵심 */
        overflow: hidden;
      }
      .clamp-2 {
        display: -webkit-box;
        -webkit-box-orient: horizontal;
        -webkit-line-clamp: 2;  /* 핵심 */
        overflow: hidden;
      }
    </style>
    <style>
      .row-scroll { scroll-behavior: smooth; overflow-x: auto; scroll-snap-type: x mandatory;}
      .card { scroll-snap-align: start; min-width: 320px; }
    </style>
  </head>
  <body class="font-[Pretendard] bg-gray-50">
    <!-- NAV -->
    <div id="navbar">
      <a class="logo" href="/"
        ><img
          src="{{ url_for('static', filename='IMG/book.png') }}"
          alt="icon"
          id="bookIcon"
        />FindMate</a
      >
      <nav class="nav-right">
        {% if user %}
        <a href="{{ url_for('mypage') }}" class="link">마이페이지</a>
        <a href="{{ url_for('logout') }}" class="btn btn-primary">로그아웃 
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
          </svg>
        </a>
        {% else %}
        <a href="{{ url_for('signup') }}" class="link">회원가입</a>
        <a href="{{ url_for('login') }}" class="btn btn-primary" >로그인<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75" />
</svg>
</a>
        {% endif %}
      </nav>
    </div>
    <!-- Flash -->
   
      {% if messages %}
        <div class="max-w-5xl mx-auto px-6 mt-4">
          {% for category, message in messages %}
            <div class="text-sm my-2 {{ 'text-red-500' if category=='error' else 'text-green-600' }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}


    <div class="flex flex-col min-h-[calc(100vh-64px)]">
      <main class="max-w-5xl mx-auto px-4 py-8 w-full">
        <!-- 내가 만든 스터디 -->
        <section class="mt-12 mb-24">
          <div class="flex items-center justify-between">
            <h2 class="mt-4 text-2xl font-extrabold text-gray-800">내가 만든 스터디 모임</h2>
          </div>

          <div class="mt-4 bg-white rounded-2xl shadow-sm p-6 pb-2">
            {% if hosted_studies %}
              <div id="row-hosted" class="row-scroll flex gap-6 p-2 clamp-2" >
                {% for s in hosted_studies %}
                  {% set sid = (s.id or s._id)|string %}
                  {% set is_active = (s.active if s.active is not none else true) %}
                  {% set when = s.date or s.startText %}
                  {% set cat = s.category %}
          
                  <a href="{{ url_for('study_detail', study_id=sid) }}" class="block no-underline text-inherit">
                    <article
                      class="card flex-shrink-0 w-80 h-60 p-6 bg-white border border-gray-200 rounded-2xl shadow-sm hover:shadow-md transition hover:-translate-y-0.5 cursor-pointer"
                      role="link"
                      aria-label="{{ s.title }}"
                    >
                      <div class="h-full flex flex-col justify-between">
                        <div class="flex items-center justify-between mb-3">
                          <div class="flex items-center gap-2">
                            <span class="px-2.5 py-1 rounded-full text-xs font-semibold
                              {{ 'bg-emerald-50 text-emerald-700 border border-emerald-200' if is_active else 'bg-gray-100 text-gray-500 border border-gray-200' }}">
                              {{ '모집중' if is_active else '마감' }}
                            </span>
                            {% if cat %}
                              <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-gray-50 text-gray-700 border border-gray-200">
                                {% if cat_map %}{{ cat_map.get(cat, cat) }}{% else %}{{ cat }}{% endif %}
                              </span>
                            {% endif %}
                          </div>
                          <span class="text-sm text-gray-500">
                            👥 {{ s.applicants_count|default(0) }}/{{ s.capacity|default('-') }}
                          </span>
                        </div>
          
                        <div class="text-center pb-16">
                          <h3 class="font-extrabold text-lg text-gray-800 mb-2 wrap-anywhere clamp-1">
                            {{ s.title }}
                          </h3>
                          <p class="text-gray-600 text-sm">{{ when or '' }}</p>
                        </div>
                      </div>
                    </article>
                  </a>
                {% endfor %}
              </div>
            {% else %}
              <div class="w-full flex justify-center items-center h-48 rounded-2xl">
                <p class="text-gray-500">주최한 스터디가 없습니다.</p>
              </div>
            {% endif %}
          </div>
          
        </section>

        <!-- 내가 참여한 스터디 -->
        <section class="mb-24">
          <div class="flex items-center justify-between">
            <h2 class="mt-4 text-2xl font-extrabold text-gray-800">내가 참여한 스터디 모임</h2>
          </div>

          <div class="mt-4 bg-white rounded-2xl shadow-sm p-6 pb-2">
            {% if attended_studies %}
              <div id="row-applied" class="row-scroll flex gap-6 p-2">
                {% for s in attended_studies %}
                  {% set sid = s.id or s._id %}
                  {% set is_active = (s.active if s.active is not none else true) %}
                  {% set when = s.date or s.startText %}
                  {% set cat = s.category %}

                  <a href="{{ url_for('study_detail', study_id=sid) }}" class="block no-underline text-inherit">
                    <article
                      class="card flex-shrink-0 w-80 h-60 p-6 bg-white border border-gray-200 rounded-2xl shadow-sm hover:shadow-md transition hover:-translate-y-0.5 cursor-pointer"
                      role="link"
                      aria-label="{{ s.title }}"
                    >
                    <div class="h-full flex flex-col justify-between">
                      <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                          <span class="px-2.5 py-1 rounded-full text-xs font-semibold
                            {{ 'bg-emerald-50 text-emerald-700 border border-emerald-200' if is_active else 'bg-gray-100 text-gray-500 border border-gray-200' }}">
                            {{ '모집중' if is_active else '마감' }}
                          </span>
                          {% if cat %}
                            <span class="px-2.5 py-1 rounded-full text-xs font-semibold bg-gray-50 text-gray-700 border border-gray-200">
                              {% if cat_map %}{{ cat_map.get(cat, cat) }}{% else %}{{ cat }}{% endif %}
                            </span>
                          {% endif %}
                        </div>
                        <span class="text-sm text-gray-500">
                          👥 {{ s.applicants_count|default(0) }}/{{ s.capacity|default('-') }}
                        </span>
                      </div>

                      <div class="text-center pb-16">
                        <h3 class="font-extrabold text-lg text-gray-800 mb-2 wrap-anywhere clamp-1">
                          {{ s.title }}
                        </h3>
                        <p class="text-gray-600 text-sm">{{ when or '' }}</p>
                      </div>
                    </div>
                  </article>
                {% endfor %}
              </div>
            {% else %}
              <div class="w-full flex justify-center items-center h-48 rounded-2xl">
                <p class="text-gray-500">신청한 스터디가 없습니다.</p>
              </div>
            {% endif %}
          </div>
        </section>
      </main>
    </div>
  </body>
</html>
